sudo: required

services:
  - docker

language: php

php:
  - 5.6
  - 7.0

env:
  DOCKER_COMPOSE_VERSION: 1.4.2

before_install:
  # Add magic from official documentation
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  # Login to the private repo
  - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD" https://johnatan.ru:5000
  # Up all the services with ignore output
  - docker-compose up </dev/null &>/dev/null &
  - if [[ "$TRAVIS_PHP_VERSION" = "5.6" ]]; then pecl install -f mailparse-2.1.6 ; fi
  - if [[ "$TRAVIS_PHP_VERSION" = "7.0" ]]; then pecl install mailparse ; fi
  - phpenv config-add travis-php-config.ini
  - composer self-update
  - composer install --prefer-source
  - php vendor/bin/codecept build

script:
  - php vendor/bin/codecept run -d --coverage-xml acceptance.xml

after_success:
  - php vendor/bin/coveralls -v --exclude-no-stmt -c .coveralls.yml

cache:
  directories:
    - $HOME/.cache/composer/
